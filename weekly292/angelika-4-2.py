from typing import List

def dfs(mp, x, y, lp, rp, mask, known):
    if (x, y) in known:
        return known[(x, y)]
    r, c = len(mp), len(mp[0])
    if mp[x][y] == '(':
        lp += 1
    else:
        rp += 1
    if lp < rp or lp > (r + c - 1) // 2 or rp > (r + c - 1) // 2 or r + c - 1 - lp - rp < abs(lp - rp):
        return False
    if lp == rp and x == r - 1 and y == c - 1:
        return True
    # print(x, y, lp, rp)

    res = (dfs(mp, x + 1, y, lp, rp, 1, known) if x + 1 < r else False) or (dfs(mp, x, y + 1, lp, rp, -1, known) if y + 1 < c else False) or (known[(x, y)] if (x, y) in known else False)
    known[(x, y)] = res
    return known[(x, y)]

def hasValidPath(grid: List[List[str]]) -> bool:
    r, c = len(grid), len(grid[0])
    if (r + c) & 1 < 1:
        return False
    return dfs(grid, 0, 0, 0, 0, 0, dict())

print(hasValidPath([[")",")"],["(","("]]))
print(hasValidPath([["(","("],[")",")"]]))
print(hasValidPath([["(","(","("],[")","(",")"],["(","(",")"],["(","(",")"]]))
print(hasValidPath([["(","(",")","(",")","(","(",")","(","(",")",")",")",")",")","(",")","(","(",")","(","(",")",")",")",")",")","(","(","(","("],[")","(","(","(",")","(",")","(","(",")",")",")",")","(",")",")","(","(",")",")","(",")","(",")","(","(",")","(",")","(","("],[")",")","(","(",")","(","(",")",")",")",")","(","(",")",")","(",")","(",")",")","(","(","(",")",")",")","(",")",")","(",")"],["(","(",")","(",")","(","(",")","(","(","(",")",")","(",")","(",")",")",")",")",")",")","(","(",")","(",")","(",")","(","("],[")",")","(",")",")","(","(","(",")",")","(",")","(",")",")",")","(","(","(",")",")","(",")","(",")",")","(","(","(","(",")"],[")",")","(","(",")","(",")","(",")","(",")","(",")",")","(",")","(",")",")","(",")","(","(","(",")","(",")",")",")","(","("],[")","(","(","(","(","(","(",")",")","(","(",")","(",")",")","(",")",")",")","(","(","(",")","(","(",")",")","(",")","(",")"],[")",")","(","(","(","(","(","(","(",")",")","(","(","(","(","(","(","(","(","(","(","(","(",")",")","(","(",")",")","(",")"],["(",")",")",")","(","(",")",")",")",")","(",")",")","(",")",")","(","(","(","(","(","(","(",")",")","(","(",")",")","(","("],["(","(",")","(",")",")",")",")","(","(","(",")",")",")","(",")","(","(",")","(","(","(",")","(","(","(","(","(",")",")",")"],["(",")","(","(","(","(",")","(","(",")",")","(","(",")","(","(","(",")","(","(","(",")",")","(",")",")","(",")","(","(",")"],[")",")","(","(","(","(",")","(","(",")",")","(",")",")","(",")","(","(","(","(","(","(","(",")","(","(",")",")","(","(","("],["(",")",")",")","(",")","(","(","(",")",")",")","(",")","(",")",")","(","(","(","(",")","(",")",")",")",")",")",")","(","("],["(","(","(","(","(","(",")",")","(",")","(","(","(",")",")","(",")","(",")","(",")","(","(","(",")",")",")","(",")","(","("],["(",")",")",")",")","(","(",")",")",")",")",")",")","(","(",")","(",")",")","(",")","(",")",")",")","(","(",")","(","(","("],["(",")",")","(","(",")",")","(",")",")","(","(","(",")",")",")",")","(","(","(",")",")","(",")","(","(","(","(",")",")",")"],[")","(","(",")","(","(",")",")",")","(","(","(","(",")","(",")",")",")","(",")","(",")","(","(",")","(","(","(","(","(","("],["(",")","(",")","(","(",")",")",")",")",")","(","(",")",")","(",")","(",")",")",")",")","(","(","(",")","(",")","(",")",")"],["(",")","(",")",")",")","(","(","(",")","(",")","(","(",")",")","(",")","(",")","(",")","(","(","(","(","(",")","(",")","("],[")",")",")",")",")","(",")",")","(","(",")","(",")",")","(",")",")","(","(","(","(",")","(","(","(","(",")",")",")",")","("],[")","(","(","(","(","(",")","(",")",")",")",")","(","(","(",")",")","(",")",")","(","(","(","(","(","(",")",")","(","(","("],["(","(","(",")",")","(",")","(",")",")",")",")","(",")",")",")",")","(",")","(","(","(","(",")","(","(","(","(","(","(",")"]]))
print(hasValidPath([["(","(","(","(","(",")",")","(",")",")","(",")",")","(",")","(","(",")",")","(",")","(",")",")","(",")",")",")",")","(",")","(","("],["(",")",")","(","(",")",")",")",")","(",")","(",")","(",")","(","(",")",")","(","(","(","(",")",")",")",")",")","(","(",")","(","("],[")",")","(","(",")",")",")",")","(",")","(",")",")",")","(","(",")","(",")","(","(","(",")",")",")",")",")",")",")",")",")","(","("],["(","(","(",")","(",")",")",")","(",")","(","(","(",")","(",")","(",")","(",")","(",")","(",")",")",")","(","(",")","(",")",")",")"],[")","(",")","(",")",")",")",")","(","(","(","(",")","(",")","(","(","(","(","(",")","(","(",")",")","(","(","(",")","(",")",")","("],[")",")",")","(",")",")",")","(","(",")",")","(","(","(","(",")","(","(",")",")","(",")",")",")","(",")",")","(",")",")","(","(","("],[")","(",")","(","(",")",")","(",")",")",")","(","(","(",")","(","(","(",")","(",")","(",")",")",")",")",")","(",")",")","(","(",")"],["(","(",")",")","(",")",")","(","(","(","(",")","(",")","(","(","(","(","(","(",")","(",")","(",")",")","(","(","(",")","(","(",")"],[")",")","(","(",")",")","(","(","(","(","(","(","(",")",")","(","(","(",")",")","(",")","(","(",")",")","(",")",")","(",")","(","("],[")",")",")",")","(",")",")","(","(","(","(",")",")",")","(",")",")",")",")",")",")","(","(","(","(",")",")",")",")","(","(","(",")"]]))
print(hasValidPath([["(","(",")","(","(",")",")","(","(","(",")","(",")",")","(",")",")",")",")",")",")","(","(",")",")","(","(","(",")",")","(","(",")",")",")","(","(",")",")",")","(",")","(","(","(",")",")"],["(","(",")","(",")","(","(",")","(",")",")",")",")",")","(",")","(","(","(","(",")","(",")",")","(","(","(","(",")",")","(",")",")",")",")",")","(",")","(",")",")",")",")","(",")","(","("],[")",")","(",")","(","(","(",")","(","(",")","(","(","(","(","(",")",")","(","(",")",")",")","(",")",")",")","(",")","(",")","(",")","(",")",")",")",")",")",")",")",")",")",")",")","(","("],["(","(",")",")","(",")","(","(",")","(",")","(",")","(","(","(","(","(","(","(","(","(",")",")",")","(",")","(",")",")","(",")",")",")","(","(",")",")",")",")",")","(","(","(","(","(","("],["(",")","(",")","(","(",")","(","(","(",")","(","(","(","(","(",")",")","(","(","(",")",")",")","(",")",")",")","(","(","(",")","(","(",")",")",")",")","(",")",")","(",")","(","(","(",")"],[")","(","(","(",")",")","(",")","(",")",")",")",")","(",")",")","(","(","(",")",")",")","(","(","(","(","(","(",")",")","(",")",")","(",")","(",")",")",")",")",")",")","(","(","(","(",")"],["(",")","(","(",")",")",")","(",")","(","(","(",")","(",")","(",")","(",")","(","(","(","(",")",")",")","(",")","(","(",")","(",")","(","(",")","(",")","(","(","(","(",")",")",")",")","("],["(",")","(","(","(",")","(","(","(",")",")","(",")",")",")",")","(",")",")",")",")","(","(","(",")","(",")","(","(","(",")",")","(","(","(","(","(",")","(","(",")","(","(","(","(","(",")"],[")","(",")","(",")",")",")",")",")",")","(",")",")",")","(",")","(",")","(","(",")","(",")","(","(",")",")","(","(","(",")",")","(","(",")",")","(","(","(","(",")","(","(","(",")",")","("],[")",")",")","(","(",")",")",")","(","(","(","(",")",")","(",")",")",")","(",")","(","(",")",")","(","(",")",")",")","(","(","(","(","(","(",")","(","(",")","(",")","(","(","(","(","(","("],[")","(",")","(","(",")",")","(","(",")",")","(",")",")",")",")","(","(","(",")","(","(","(","(","(","(","(","(",")","(","(","(",")",")",")",")",")",")",")",")","(",")","(",")","(","(","("],[")","(",")",")",")",")","(","(",")","(","(","(",")",")","(","(",")","(","(","(",")","(","(","(",")",")","(",")","(","(","(",")","(",")",")","(","(","(","(","(","(",")",")","(","(",")",")"]]))